<script nonce="<%= locals.nonce %>">
    const socket = io({
        auth: {
            type: 0,
            user: "<%= locals.name %>",
            room: "<%= locals.room %>"
        }
    });

    document.getElementById("start").addEventListener("click", function(){
        socket.emit("start");
    });

    document.getElementById("skip").addEventListener("click", function(){
        socket.emit("skip");
    });

    document.getElementById("finish").addEventListener("click", function(){
        socket.emit("finish");
    });

    document.querySelectorAll("page#lobby div.colors div").forEach(function(e, i){
        e.addEventListener("click", function(){
            socket.emit("update", "skin", i);
        });
    });

    socket.on("owner", function(){
        document.getElementById("start").setAttribute("active", "1");
        document.getElementById("skip").setAttribute("active", "1");
    });

    socket.on("money", function(money){
        document.getElementById("money").innerText = money;
    });

    socket.on("startRound", function(users){
        var container = document.getElementById("debatewith");
        container.innerHTML = "";

        for(var user of users){
            if(user.id == socket.id) continue;
            var button = document.createElement("button");
            button.innerText = user.name;

            function listener(){
                button.removeEventListener("click", listener);
                socket.emit("debate", user.id);
            }

            button.addEventListener("click", listener);
            container.append(button);
        }

        setActive("dashboard");
    });

    socket.on("cutscene", function(){
        setActive("waiting");
    });
    
    socket.on("message", function(message){
        document.getElementById("messageContent").innerText = message;
        setActive("message");
    });

    socket.on("dc", () => window.location = "/join");

    function setActive(id){
        document.querySelectorAll("page").forEach((page) => page.setAttribute("active", "0"));
        document.getElementById(id).setAttribute("active", "1");
    }
</script>